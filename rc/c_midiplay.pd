#N canvas 69 105 492 301 10;
#X obj 327 13 inlet;
#X obj 29 14 inlet;
#X obj 101 169 s \$0-file;
#X obj 138 139 s \$0-reopen;
#X msg 138 114 bang;
#X obj 134 233 outlet ticks;
#N canvas 582 67 485 410 midifile 1;
#X msg 45 141 rewind;
#X msg 179 209 read \$1;
#X obj 57 168 loadbang;
#X msg 57 196 verbose 0;
#X obj 132 142 symbol;
#X obj 20 370 outlet midi;
#X obj 142 48 r \$0-file;
#X obj 132 19 r \$0-reopen;
#X obj 20 19 inlet ticks;
#X obj 45 112 r \$0-rewind;
#X obj 147 236 s \$0-rewind;
#X obj 129 370 outlet info;
#X obj 20 330 spigot;
#X msg 263 209 0;
#X obj 132 167 t b b b a b;
#X msg 132 261 1;
#N canvas 284 208 593 437 tempo 0;
#X obj 45 16 inlet;
#X obj 237 111 unpack f f f f;
#X msg 163 378 bpm \$1;
#X obj 163 238 /;
#X msg 163 210 6e+07 \$1;
#X obj 45 407 outlet;
#X obj 83 211 /;
#X obj 83 239 / 1000;
#X obj 83 272 s \$0-file_tempo;
#X text 444 137 stop at end of file;
#X obj 417 242 spigot;
#X obj 417 271 s \$0-run;
#X obj 390 327 s \$0-rewind;
#X msg 417 138 0;
#X obj 450 190 sel 0;
#X msg 450 215 1;
#X msg 482 216 0;
#X obj 450 164 r \$0-loop;
#X obj 83 56 route microsec_per_quarternote ticks_per_quarternote time_sig
bang;
#X obj 390 116 t b b;
#X obj 160 174 s \$0-ticksperbeat;
#X text 242 193 send bpm if changed;
#X obj 237 141 s \$0-beatspermeasure;
#X obj 262 239 r \$0-file;
#X obj 282 263 r \$0-reopen;
#X obj 262 327 delay 5;
#X obj 163 295 t f b;
#X msg 262 352 120;
#X msg 190 322 stop;
#X obj 262 294 t b;
#X msg 324 379 time_sig 4 4 0 0;
#X text 291 352 send default values if no file info;
#X obj 324 327 delay 5;
#X msg 324 296 stop;
#X obj 390 298 delay 2;
#X obj 479 270 r \$0-file_tempo;
#X obj 435 67 r \$0-eof;
#X obj 390 94 spigot 1;
#X connect 0 0 5 0;
#X connect 0 0 18 0;
#X connect 1 0 22 0;
#X connect 1 0 33 0;
#X connect 2 0 5 0;
#X connect 3 0 26 0;
#X connect 4 0 3 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 10 0 11 0;
#X connect 13 0 10 0;
#X connect 14 0 15 0;
#X connect 14 1 16 0;
#X connect 15 0 10 1;
#X connect 16 0 10 1;
#X connect 17 0 14 0;
#X connect 18 0 4 0;
#X connect 18 0 6 0;
#X connect 18 1 6 1;
#X connect 18 1 20 0;
#X connect 18 2 1 0;
#X connect 18 3 37 0;
#X connect 19 0 34 0;
#X connect 19 1 13 0;
#X connect 23 0 29 0;
#X connect 24 0 29 0;
#X connect 25 0 27 0;
#X connect 26 0 2 0;
#X connect 26 1 28 0;
#X connect 27 0 2 0;
#X connect 28 0 25 0;
#X connect 29 0 25 0;
#X connect 29 0 32 0;
#X connect 30 0 5 0;
#X connect 32 0 30 0;
#X connect 33 0 32 0;
#X connect 34 0 12 0;
#X connect 35 0 34 1;
#X connect 36 0 37 1;
#X connect 37 0 19 0;
#X restore 129 333 pd tempo and loop;
#X text 223 166 bang once after loading file to get info;
#X text 135 300 use spigot to catch first note when getting info;
#N canvas 469 254 210 155 reset 0;
#X obj 16 17 inlet;
#X msg 16 43 bang;
#X obj 16 68 \$0;
#X msg 16 93 \; \$1-file_tempo 2.60417 \; \$1-ticksperbeat 192 \; \$1-beatspermeasure
4;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X restore 262 241 pd reset tempo;
#X obj 142 77 route bang;
#X obj 142 105 openpanel;
#X obj 20 260 midifile;
#X obj 208 106 u_list2symbol;
#X connect 0 0 22 0;
#X connect 1 0 22 0;
#X connect 2 0 3 0;
#X connect 3 0 15 0;
#X connect 3 0 22 0;
#X connect 4 0 14 0;
#X connect 6 0 20 0;
#X connect 7 0 4 0;
#X connect 8 0 22 0;
#X connect 9 0 0 0;
#X connect 12 0 5 0;
#X connect 13 0 12 1;
#X connect 14 0 15 0;
#X connect 14 1 10 0;
#X connect 14 2 22 0;
#X connect 14 3 1 0;
#X connect 14 4 13 0;
#X connect 14 4 19 0;
#X connect 15 0 12 1;
#X connect 16 0 11 0;
#X connect 20 0 21 0;
#X connect 20 1 23 0;
#X connect 21 0 4 0;
#X connect 22 0 12 0;
#X connect 22 2 16 0;
#X connect 23 0 4 0;
#X restore 29 233 pd midifile;
#N canvas 307 127 483 543 midi 0;
#X obj 25 12 inlet run;
#N canvas 126 213 285 201 bpm2miditick 0;
#X obj 35 32 inlet;
#X obj 35 168 outlet;
#X obj 35 141 /;
#X obj 62 59 r \$0-ticksperbeat;
#X text 8 5 ms per tick = 60000 / (bpm * ticks per beat);
#X obj 35 83 * 192;
#X msg 35 112 60000 \$1;
#X connect 0 0 5 0;
#X connect 2 0 1 0;
#X connect 3 0 5 1;
#X connect 5 0 6 0;
#X connect 6 0 2 0;
#X restore 91 122 pd bpm2miditick;
#X obj 91 95 r \$0-bpm;
#X obj 271 452 + 1;
#X msg 301 255 0;
#X obj 268 139 / 4;
#X obj 174 325 + 1;
#X obj 268 79 t b f;
#X obj 316 80 r \$0-ticksperbeat;
#X obj 268 163 int;
#X obj 235 501 outlet ticks;
#X obj 113 239 * 48;
#X obj 113 268 t f f;
#X text 206 324 pos in midi ticks;
#X obj 25 304 t b b;
#X obj 113 188 int;
#X obj 52 503 outlet bangs;
#X obj 39 43 r \$0-run;
#X obj 301 230 r \$0-rewind;
#X obj 309 112 moses 1;
#X obj 113 164 r \$0-pos;
#X obj 38 190 r \$0-bang;
#X obj 38 268 until;
#X obj 268 112 f 192;
#X obj 64 69 r \$0-file_tempo;
#X obj 268 39 r \$0-beatspermeasure;
#X text 300 162 calc length of 1 beat tick;
#X obj 25 148 metro 2;
#X text 276 186 default: 192 midi ticks / beat;
#X text 284 366 default: 192/4;
#X text 248 475 pos in beat ticks;
#X obj 235 366 mod 48;
#X obj 235 394 sel 0;
#X obj 113 212 t f f;
#X obj 328 394 t b f;
#X obj 301 277 t f f;
#X obj 235 451 f 0;
#X obj 140 324 f 0;
#X obj 38 243 f 48;
#X obj 188 166 r \$0-set;
#X obj 188 222 t f f;
#X obj 188 193 int;
#X obj 188 247 * 48;
#X obj 188 270 t f f;
#X connect 0 0 27 0;
#X connect 1 0 27 1;
#X connect 2 0 1 0;
#X connect 3 0 36 1;
#X connect 4 0 35 0;
#X connect 5 0 9 0;
#X connect 6 0 37 1;
#X connect 7 0 23 0;
#X connect 7 1 19 0;
#X connect 8 0 23 1;
#X connect 9 0 11 1;
#X connect 9 0 31 1;
#X connect 9 0 38 1;
#X connect 9 0 42 1;
#X connect 11 0 12 0;
#X connect 12 0 16 0;
#X connect 12 1 37 0;
#X connect 14 0 37 0;
#X connect 14 1 16 0;
#X connect 15 0 33 0;
#X connect 17 0 27 0;
#X connect 18 0 4 0;
#X connect 19 1 5 1;
#X connect 20 0 15 0;
#X connect 21 0 38 0;
#X connect 22 0 14 0;
#X connect 23 0 5 0;
#X connect 24 0 27 1;
#X connect 25 0 7 0;
#X connect 27 0 14 0;
#X connect 31 0 32 0;
#X connect 32 0 36 0;
#X connect 33 0 11 0;
#X connect 33 1 36 1;
#X connect 34 0 36 0;
#X connect 34 1 36 1;
#X connect 35 0 37 1;
#X connect 35 1 34 0;
#X connect 36 0 3 0;
#X connect 36 0 10 0;
#X connect 37 0 6 0;
#X connect 37 0 31 0;
#X connect 38 0 22 0;
#X connect 39 0 41 0;
#X connect 40 0 42 0;
#X connect 40 1 3 0;
#X connect 41 0 40 0;
#X connect 42 0 43 0;
#X connect 43 0 16 0;
#X connect 43 1 6 0;
#X restore 29 196 pd midi tick metro;
#N canvas 134 125 577 258 midi 0;
#X obj 27 38 inlet midi;
#N canvas 266 248 259 228 ctlin 0;
#X obj 24 26 inlet;
#X obj 24 61 unpack f f f;
#X obj 24 122 pack f f f;
#X text 114 63 event+chan ctl val;
#X text 106 119 chan ctl val;
#X text 134 156 val ctl chan;
#X msg 24 151 \; #ctlin \$3 \$2 \$1;
#X obj 24 91 - 175;
#X connect 0 0 1 0;
#X connect 1 0 7 0;
#X connect 1 1 2 1;
#X connect 1 2 2 2;
#X connect 2 0 6 0;
#X connect 7 0 2 0;
#X restore 165 197 pd ctlin;
#X text 11 8 parse the raw bytes and send to built in midi objects
;
#N canvas 109 375 234 206 pgmin 0;
#X obj 41 25 inlet;
#X obj 41 117 pack f f;
#X obj 98 88 + 1;
#X text 104 116 chan pgm;
#X text 113 55 event+chan pgm;
#X obj 41 57 unpack f f;
#X text 140 147 chan pgm;
#X msg 41 149 \; #pgmin \$2 \$1;
#X obj 41 87 - 191;
#X connect 0 0 5 0;
#X connect 1 0 7 0;
#X connect 2 0 1 1;
#X connect 5 0 8 0;
#X connect 5 1 2 0;
#X connect 8 0 1 0;
#X restore 313 193 pd pgmin;
#N canvas 266 248 247 249 bendin 0;
#X obj 22 20 inlet;
#X obj 22 55 unpack f f f;
#X text 109 54 event+chan lo hi;
#X obj 91 86 << 7;
#X obj 67 114 +, f 4;
#X text 95 173 chan val;
#X obj 22 173 pack f f;
#X obj 22 85 - 223;
#X obj 67 143 - 8192;
#X msg 22 203 \; #bendin \$2 \$1;
#X connect 0 0 1 0;
#X connect 1 0 7 0;
#X connect 1 1 4 0;
#X connect 1 2 3 0;
#X connect 3 0 4 1;
#X connect 4 0 8 0;
#X connect 6 0 9 0;
#X connect 7 0 6 0;
#X connect 8 0 6 1;
#X restore 211 167 pd bendin;
#N canvas 361 374 234 207 touchin 0;
#X obj 34 22 inlet;
#X obj 34 115 pack f f, f 10;
#X obj 34 55 unpack f f;
#X text 106 55 event+chan val;
#X text 108 114 chan val;
#X obj 34 85 - 207;
#X msg 34 147 \; #touchin \$2 \$1;
#X text 135 148 chan val;
#X connect 0 0 2 0;
#X connect 1 0 6 0;
#X connect 2 0 5 0;
#X connect 2 1 1 1;
#X connect 5 0 1 0;
#X restore 356 164 pd touchin;
#N canvas 266 248 266 202 polytouchin 0;
#X obj 24 26 inlet;
#X obj 24 59 unpack f f f;
#X obj 24 120 pack f f f;
#X text 113 61 event+chan note val;
#X text 106 117 chan note val;
#X text 161 158 val note chan;
#X msg 24 149 \; #polytouchin \$3 \$2 \$1;
#X obj 24 89 - 159;
#X connect 0 0 1 0;
#X connect 1 0 7 0;
#X connect 1 1 2 1;
#X connect 1 2 2 2;
#X connect 2 0 6 0;
#X connect 7 0 2 0;
#X restore 119 228 pd polytouchin;
#N canvas 447 211 523 210 notein 0;
#X obj 34 21 inlet;
#X obj 34 54 unpack f f f;
#X obj 34 115 pack f f f;
#X text 120 52 event+chan note vel;
#X text 110 113 chan note vel;
#X text 159 146 note vel chan;
#X obj 34 85 - 127;
#X obj 265 54 unpack f f f;
#X obj 265 115 pack f f f;
#X text 351 52 event+chan note vel;
#X text 341 113 chan note vel;
#X text 387 146 note vel chan;
#X obj 265 85 - 143;
#X msg 34 145 \; #notein \$2 0 \$1;
#X msg 265 145 \; #notein \$2 \$3 \$1;
#X obj 265 22 inlet;
#X connect 0 0 1 0;
#X connect 1 0 6 0;
#X connect 1 1 2 1;
#X connect 1 2 2 2;
#X connect 2 0 13 0;
#X connect 6 0 2 0;
#X connect 7 0 12 0;
#X connect 7 1 8 1;
#X connect 7 2 8 2;
#X connect 8 0 14 0;
#X connect 12 0 8 0;
#X connect 15 0 7 0;
#X restore 27 229 pd notein;
#N canvas 531 118 513 442 detect 0;
#X obj 16 14 inlet;
#X obj 145 120 moses 160;
#X text 211 119 poly aftertouch;
#X obj 196 146 moses 176;
#X text 261 145 control change;
#X text 365 197 pitch bend;
#X obj 43 68 moses 128;
#X obj 94 94 moses 144;
#X text 109 67 noteoff;
#X text 160 93 noteon;
#X obj 16 350 list prepend;
#X obj 16 47 t a a;
#X msg 94 146 noteoff;
#X msg 145 172 noteon;
#X obj 16 377 list trim;
#X msg 196 198 polytouch;
#X obj 16 404 outlet;
#X msg 247 224 ctl;
#X msg 349 250 bend;
#X obj 247 172 moses 192;
#X text 307 172 (program change \, 208 aftertouch);
#X obj 298 198 moses 224;
#X obj 349 224 moses 240;
#X connect 0 0 11 0;
#X connect 1 0 13 0;
#X connect 1 1 3 0;
#X connect 3 0 15 0;
#X connect 3 1 19 0;
#X connect 6 1 7 0;
#X connect 7 0 12 0;
#X connect 7 1 1 0;
#X connect 10 0 14 0;
#X connect 11 0 10 0;
#X connect 11 1 6 0;
#X connect 12 0 10 1;
#X connect 13 0 10 1;
#X connect 14 0 16 0;
#X connect 15 0 10 1;
#X connect 17 0 10 1;
#X connect 18 0 10 1;
#X connect 19 0 17 0;
#X connect 19 1 21 0;
#X connect 21 1 22 0;
#X connect 22 0 18 0;
#X restore 27 106 pd detect message type from status byte;
#N canvas 1059 153 259 292 detect 0;
#X obj 16 14 inlet;
#X obj 16 200 list prepend;
#X obj 16 47 t a a;
#X obj 16 227 list trim;
#X obj 16 254 outlet;
#X obj 43 74 moses 192;
#X text 111 74 program change;
#X text 162 102 aftertouch;
#X obj 94 102 moses 208;
#X obj 145 129 moses 224;
#X msg 94 156 pgm;
#X msg 145 156 touch;
#X connect 0 0 2 0;
#X connect 1 0 3 0;
#X connect 2 0 1 0;
#X connect 2 1 5 0;
#X connect 3 0 4 0;
#X connect 5 1 8 0;
#X connect 8 0 10 0;
#X connect 8 1 9 0;
#X connect 9 0 11 0;
#X connect 10 0 1 1;
#X connect 11 0 1 1;
#X restore 313 105 pd detect message type from status byte;
#X obj 27 136 route noteoff noteon polytouch ctl bend;
#X obj 313 135 route pgm touch;
#X obj 313 76 u_listlastx 2;
#X obj 27 74 u_listlastx 3;
#X obj 313 225 pgmin;
#X text 359 224 silence missing object errors;
#X obj 261 225 touchin;
#X obj 455 198 notein;
#X obj 504 198 ctlin;
#X connect 0 0 12 0;
#X connect 0 0 13 0;
#X connect 8 0 10 0;
#X connect 9 0 11 0;
#X connect 10 0 7 0;
#X connect 10 1 7 1;
#X connect 10 2 6 0;
#X connect 10 3 1 0;
#X connect 10 4 4 0;
#X connect 11 0 3 0;
#X connect 11 1 5 0;
#X connect 12 0 9 0;
#X connect 13 0 8 0;
#X restore 29 264 pd midi sends;
#X msg 174 90 bang;
#X obj 174 115 s \$0-rewind;
#N canvas 172 83 586 377 LICENSE-GPL 0;
#X text 57 88 This program is free software: you can redistribute it
and/or modify it under the terms of the GNU General Public License
as published by the Free Software Foundation \, either version 3 of
the License \, or (at your option) any later version.;
#X text 58 168 This program is distributed in the hope that it will
be useful \, but WITHOUT ANY WARRANTY \; without even the implied warranty
of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
General Public License for more details.;
#X text 57 261 You should have received a copy of the GNU General Public
License along with this program. If not \, see <http://www.gnu.org/licenses/>.
;
#X text 60 325 See the file LICENSE.txt for the full license text.
;
#X text 56 54 Copyright (C) 2012 \, Dan Wilcox <danomatika@gmail.com>
;
#X restore 326 197 pd LICENSE-GPL;
#X obj 211 90 s \$0-pos;
#X obj 65 71 s \$0-bang;
#X obj 175 264 outlet info;
#X obj 327 118 s \$0-bpm;
#X obj 362 92 s \$0-loop;
#N canvas 645 99 216 149 defaults 0;
#X obj 22 77 outlet;
#X obj 22 18 loadbang;
#X msg 84 79 4;
#X obj 84 107 s \$0-ticksperbeat;
#X msg 22 47 bpm 120 \, loop 0;
#X connect 1 0 4 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 4 0 0 0;
#X restore 387 13 pd defaults;
#X obj 247 69 s \$0-set;
#X obj 29 44 route float bang open reopen rewind pos set;
#X obj 327 44 route bpm loop eof;
#X obj 397 70 s \$0-eof;
#X connect 0 0 20 0;
#X connect 1 0 19 0;
#X connect 4 0 3 0;
#X connect 6 0 8 0;
#X connect 6 1 14 0;
#X connect 7 0 6 0;
#X connect 7 1 5 0;
#X connect 9 0 10 0;
#X connect 17 0 20 0;
#X connect 19 0 7 0;
#X connect 19 1 13 0;
#X connect 19 2 2 0;
#X connect 19 3 4 0;
#X connect 19 4 9 0;
#X connect 19 5 12 0;
#X connect 19 6 18 0;
#X connect 20 0 15 0;
#X connect 20 1 16 0;
#X connect 20 2 21 0;
